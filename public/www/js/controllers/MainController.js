// Generated by CoffeeScript 1.10.0
app.controller('MainController', function($scope, $location, $http) {
  $scope.goto = function(path) {
    return $location.path(path);
  };
  $scope.json = {};
  $scope.colors = ['#9300a5', '#ed8875', '#ed3363', '#ef8ca8'];
  $scope.offices = ['Deva', 'Cluj-Napoca', 'Oradea'];
  $http({
    method: 'GET',
    url: '/api/projects'
  }).then(function(response) {
    var activeProjectsLastMonth, i, len, prj, ref, onTrackProjects, date;
    $scope.json.report = response.data.body;
    activeProjectsLastMonth = 0;
    onTrackProjects = 0;
    ref = $scope.json.report.projects;
    date = new Date();
    date.setTime(date.getTime() - 5 * 24 * 60 * 60 * 1000);

    for (i = 0, len = ref.length; i < len; i++) {
      prj = ref[i];
      prj.old = isOld(prj);
      prj.tkwDescription = parseTkwDescription(prj);
      if (prj.tkwDescription.status == "On track")
      {
          onTrackProjects += 1;
      }
      if (!prj.old) {
        activeProjectsLastMonth += 1;
      }
      prj.activeButWithoutOnTrack = new Date(prj.last_activity) > date && prj.tkwDescription.status != "On track";
    }
    $scope.json.report.onTrackProjects = onTrackProjects;
    return $scope.json.report.activeProjectsLastMonth = activeProjectsLastMonth;
  });
  return $http({
    method: 'GET',
    url: '/api/tecknoworkers/graph'
  }).then(function(response) {
    var cnt, i, len, loc, ref;
    $scope.json.users = response.data.body.graph;
    cnt = 0;
    ref = $scope.json.users;
    for (i = 0, len = ref.length; i < len; i++) {
      loc = ref[i];
      if ($scope.offices.indexOf(loc.key) !== -1) {
        cnt += loc.y;
      }
    }
    return $scope.json.employeeCount = cnt;
  });
});
