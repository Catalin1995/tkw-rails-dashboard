// Generated by CoffeeScript 1.10.0
app.controller('TecknoworkersController', function($scope, $http) {

  $scope.selected = ['Deva', 'Cluj-Napoca', 'Oradea'];
  $scope.usersCount = 0;
  $scope.filteredUsers = [];

  $scope.exists = function (item, list) {
    return list.indexOf(item) > -1;
  };

  function filterUsers(list){
    $scope.usersCount = 0;
    $scope.filteredUsers = [];
    for(var i = 0; i < list.length; i++){
      for(var j = 0; j < $scope.json.fullUsers.length; j++){
        if(list[i] == $scope.json.fullUsers[j].key){
          for(var k = 0; k < $scope.json.fullUsers[j].users.length; k++){
            $scope.filteredUsers.push($scope.json.fullUsers[j].users[k]);
          }
          $scope.usersCount += $scope.json.fullUsers[j].count;
        }
      }
    }
    return $scope.title = "Tecknoworkers " + $scope.usersCount;
  }

  $http({
    method: 'GET',
    url: '/api/tecknoworkers'
  }).then(function(response) {
    var cnt, i, len, loc, ref;
    $scope.json.fullUsers = response.data.body.tecknoworkers;
    cnt = 0;
    ref = $scope.json.fullUsers;
    for(var i = 0; i < $scope.json.fullUsers.length; i++){
      for(var j = 0; j < $scope.json.fullUsers[i].users.length; j++){
        $scope.json.fullUsers[i].users[j].office = $scope.json.fullUsers[i].key
      }
    }
    filterUsers($scope.selected);
  });

  $scope.toggle = function(item, list) {
    var idx = list.indexOf(item);

    if (idx > -1) {
      list.splice(idx, 1);
    }
    else {
      list.push(item);
    }
    filterUsers(list);
  };

  return $scope.title = "Tecknoworkers " + $scope.usersCount;

});
